$.extend({__time_picker_load:function(settings){$(function(){$('body').append('<div style="display:none" id="__time_picker_wrapper"><div id="__time_picker_mask"></div><div id="__time_picker"><div id="__time-picker-preview"></div><div class="__time-picker-date __time-picker-flex"><div class="__time-picker-value-section __time-picker-flex"><button type="button" class="__time-picker-value-left">&lt;</button><div class="__time-picker-value-middle __time-picker-value-year" id="__time_picker_year_select">2017</div><button type="button" class="__time-picker-value-right">&gt;</button></div><span class="__time-picker-tag">&nbsp;-&nbsp;</span><div class="__time-picker-value-section __time-picker-flex"><button type="button" class="__time-picker-value-left">&lt;</button><div class="__time-picker-value-middle __time-picker-value-month" id="__time_picker_month_select">1</div><button type="button" class="__time-picker-value-right">&gt;</button></div></div><div class="__time-picker-flex __time-picker-week-list"><div class="__time-picker-week">日</div><div class="__time-picker-week">一</div><div class="__time-picker-week">二</div><div class="__time-picker-week">三</div><div class="__time-picker-week">四</div><div class="__time-picker-week">五</div><div class="__time-picker-week">六</div></div><div class="__time-picker-date-select" id="__time-picker-data_list"></div><div class="__time-picker-time __time-picker-flex"><div class="__time-picker-value-section __time-picker-flex"><button type="button" class="__time-picker-value-left">&lt;</button><div class="__time-picker-value-middle __time-picker-value-hour" id="__time_picker_hour_select">00</div><button type="button" class="__time-picker-value-right">&gt;</button></div><span class="__time-picker-tag">&nbsp;:&nbsp;</span><div class="__time-picker-value-section __time-picker-flex"><button type="button" class="__time-picker-value-left">&lt;</button><div class="__time-picker-value-middle __time-picker-value-minute" id="__time_picker_minute_select">00</div><button type="button" class="__time-picker-value-right">&gt;</button></div></div><div class="__time-picker-button __time-picker-flex"><button id="__time_picker_cancel">取消</button><button id="__time_picker_today">今天</button><button id="__time_picker_confirm">确定</button></div><div id="__time-picker-down_list"><div id="__time-picker-down_list_wrapper"></div><div class="__time-picker-down-list"><div class="__time-picker-down-list-close">×</div><div id="__time-picker-year_change_prev" style="display: none;"></div><div id="__time-picker-down_list_content"></div><div id="__time-picker-year_change_next" style="display: none;"></div></div></div></div></div>');var _v={$input:$('.__time-picker-input'),$inputs:$('.__time-picker-input'),$timePicker:$('#__time_picker'),$datePreview:$('#__time-picker-preview'),$timePickerWrapper:$('#__time_picker_wrapper'),$timePickerMask:$('#__time_picker_mask'),$timePickerDateList:$('#__time-picker-data_list'),isTop:false,$body:$('body'),input_window_top:0,input_body_top:0,input_body_left:0,bodyOffsetTop:settings.bodyOffsetTop||0,bodyOffsetLeft:settings.bodyOffsetLeft||0,offsetTop:settings.offsetTop||0,bgColor:settings.bgColor||'rgba(0,0,0,0)',downListBgColor:settings.downListBgColor||'rgba(0,0,0,0)',format:settings.format||'yy-mm-dd hh-mm-ss',isLinkage:settings.isLinkage,$valueSub:$('#__time_picker .__time-picker-value-left'),$valueAdd:$('#__time_picker .__time-picker-value-right'),$value:$('#__time_picker .__time-picker-value-middle'),$downList:$('#__time-picker-down_list'),$downListClose:$('#__time-picker-down_list .__time-picker-down-list-close'),$downListWrapper:$('#__time-picker-down_list_wrapper'),$downListContent:$('#__time-picker-down_list_content'),$downListYearPrev:$('#__time-picker-year_change_prev'),$downListYearNext:$('#__time-picker-year_change_next'),$s_year:$('#__time_picker_year_select'),s_year:parseInt(new Date().getFullYear()),$s_month:$('#__time_picker_month_select'),s_month:parseInt(new Date().getMonth())+1,$s_day:$('#__time_picker_day_select'),s_day:parseInt(new Date().getDate()),$s_hour:$('#__time_picker_hour_select'),s_hour:parseInt(new Date().getHours()),$s_minute:$('#__time_picker_minute_select'),s_minute:new Date().getMinutes(),$s_second:$('#__time_picker_second_select'),s_second:new Date().getSeconds(),$btn_confirm:$('#__time_picker_confirm'),$btn_cancel:$('#__time_picker_cancel'),$btn_today:$('#__time_picker_today'),closeTiming:settings.closeTiming||'button',isScroll:true,init:function(){_v.$inputs.on('click',function(){_v.$input=$(this);_v.input_body_top=parseInt(_v.$input.offset().top-_v.bodyOffsetTop);_v.input_body_left=parseInt(_v.$input.offset().left-_v.bodyOffsetLeft);_v.input_window_top=parseInt(_v.$input.offset().top-parseInt($(window).scrollTop()));_v.$timePicker.css('top',_v.input_body_top+parseInt(_v.$input.height())+_v.offsetTop+'px');_v.$timePicker.css('left',_v.input_body_left+'px')});_v.updateDaysList(_v.s_year,_v.s_month,_v.s_day);_v.$datePreview.text(_v.dataFormat(_v.format));if(_v.isLinkage==undefined){_v.isLinkage=true}_v.input_body_top=parseInt(_v.$input.offset().top-_v.bodyOffsetTop);_v.input_body_left=parseInt(_v.$input.offset().left-_v.bodyOffsetLeft);_v.input_window_top=parseInt(_v.$input.offset().top-parseInt($(window).scrollTop()));_v.$timePicker.css('top',_v.input_body_top+parseInt(_v.$input.height())+_v.offsetTop+'px');_v.$timePicker.css('left',_v.input_body_left+'px');_v.$timePickerMask.css('width',_v.$body.width());_v.$timePickerMask.css('height',_v.$body.height());_v.$timePickerMask.css('background',_v.bgColor);_v.$downListWrapper.css('background',_v.downListBgColor);_v.$s_year.text(_v.s_year);_v.$s_month.text(_v.addZero(_v.s_month));_v.$s_day.text(_v.addZero(_v.s_day));_v.$s_hour.text(_v.addZero(_v.s_hour));_v.$s_minute.text(_v.addZero(_v.s_minute));_v.$s_second.text(_v.addZero(_v.s_second))},addZero:function(val){return parseInt(val)<10?'0'+val:val},getMonths:function(year,month){var total=0;if(month=='1'||month=='3'||month=='5'||month=='7'||month=='8'||month=='10'||month=='12'){total=31}else if(month=='4'||month=='6'||month=='9'||month=='11'){total=30}else{if((year%4==0&&year%100!=0)||year%400==0){total=29}else{total=28}}return total},updateData:function(obj){if(obj.year!=undefined){_v.s_year=parseInt(obj.year);_v.$s_year.text(_v.s_year)}if(obj.month!=undefined){if(obj.month==0){if(_v.isLinkage){_v.s_year--;_v.updateData({year:_v.s_year})}_v.s_month=12}else if(obj.month==13){if(_v.isLinkage){_v.s_year++;_v.updateData({year:_v.s_year})}_v.s_month=1}else{_v.s_month=parseInt(obj.month)}_v.$s_month.text(_v.addZero(_v.s_month))}if(obj.day!=undefined){if(obj.day==0){if(_v.isLinkage){_v.s_month--;_v.updateData({month:_v.s_month})}_v.s_day=_v.getMonths(_v.s_year,_v.s_month)}else if(obj.day==_v.getMonths(_v.s_year,_v.s_month)+1){if(_v.isLinkage){_v.s_month++;_v.updateData({month:_v.s_month})}_v.s_day=1}else{_v.s_day=parseInt(obj.day)}_v.$s_day.text(_v.addZero(_v.s_day))};_v.updateDaysList(_v.s_year,_v.s_month,_v.s_day);if(obj.hour!=undefined){if(obj.hour==-1){if(_v.isLinkage){_v.s_day--;_v.updateData({day:_v.s_day})}_v.s_hour=0}else if(obj.hour==24){if(_v.isLinkage){_v.s_day++;_v.updateData({day:_v.s_day})}_v.s_hour=0}else{_v.s_hour=parseInt(obj.hour)}_v.$s_hour.text(_v.addZero(_v.s_hour))}if(obj.minute!=undefined){if(obj.minute==-1){if(_v.isLinkage){_v.s_hour--;_v.updateData({hour:_v.s_hour})}_v.s_minute=59}else if(obj.minute==60){if(_v.isLinkage){_v.s_hour++;_v.updateData({hour:_v.s_hour})}_v.s_minute=0}else{_v.s_minute=parseInt(obj.minute)}_v.$s_minute.text(_v.addZero(_v.s_minute))}if(obj.second!=undefined){if(obj.second==-1){if(_v.isLinkage){_v.s_minute--;_v.updateData({minute:_v.s_minute})}_v.s_second=59}else if(obj.second==60){if(_v.isLinkage){_v.s_minute++;_v.updateData({minute:_v.s_minute})}_v.s_second=0}else{_v.s_second=parseInt(obj.second)}_v.$s_second.text(_v.addZero(_v.s_second))}_v.$datePreview.text(_v.dataFormat(_v.format))},updateDaysList:function(y,m,d){var day=new Date(y+'-'+m+'-1').getDay();var monthDays=_v.getMonths(y,m);var list=[];if(day>0){var prevMonthDays=_v.getMonths(y,parseInt(m)-1);for(var i=0;i<day;i++){list.push(prevMonthDays);prevMonthDays--}list.reverse()};for(var i=1;i<=monthDays;i++){list.push(i)};var remainder=list.length%7;if(remainder!=0){for(var i=0;i<(7-remainder);i++){list.push(i+1)}};var listDom='<div class="__time-picker-flex">';var listLen=list.length;for(var i=0;i<listLen;i++){if(i<7&&list[i]>7){listDom+='<div class="__time-picker-day __time-picker-disable __time-picker-prev-month">'+list[i]+'</div>'}else if(i+7>listLen&&list[i]<7){listDom+='<div class="__time-picker-day __time-picker-disable __time-picker-next-month">'+list[i]+'</div>'}else{if(d==list[i]){listDom+='<div class="__time-picker-day __time-picker-active">'+list[i]+'</div>'}else{listDom+='<div class="__time-picker-day">'+list[i]+'</div>'}}if((i+1)%7==0&&i<listLen-7){listDom+='</div>';listDom+='<div class="__time-picker-flex">'}if(i+1==listLen){listDom+='</div>'}};_v.$timePickerDateList.empty();_v.$timePickerDateList.append(listDom)},dataFormat:function(format){var arr=format.split(' ');var date=arr[0].split('-').join('');var time=arr[1].split('-').join('');var result='';if(date.indexOf('yy')!=-1){result+=_v.s_year;if(date.indexOf('yy')<date.length/2){result+='-'}};if(date.indexOf('mm')!=-1){result+=_v.addZero(_v.s_month);if(date.indexOf('mm')<date.length/2){result+='-'}};if(date.indexOf('dd')!=-1){result+=_v.addZero(_v.s_day)};result+=' ';if(time.indexOf('hh')!=-1){result+=_v.addZero(_v.s_hour);if(time.indexOf('hh')<time.length/2){result+=':'}};if(time.indexOf('mm')!=-1){result+=_v.addZero(_v.s_minute);if(time.indexOf('mm')<time.length/2){result+=':'}};if(time.indexOf('ss')!=-1){result+=_v.addZero(_v.s_second)};return result}};_v.init();_v.$downListWrapper.click(function(){_v.$downList.hide()});_v.$input.on('click',function(){_v.$timePickerWrapper.show();_v.$downList.hide();if(_v.isScroll){if(parseInt($(window).height())-_v.input_window_top-_v.bodyOffsetTop<_v.$timePicker.outerHeight()){if(!_v.isTop){_v.$timePicker.css('top',parseInt(_v.$timePicker.css('top'))-parseInt($('#__time_picker').outerHeight())-_v.offsetTop*2-parseInt(_v.$input.height())+'px');_v.isTop=true}}else{_v.isTop=false;_v.$timePicker.css('top',_v.input_body_top+parseInt(_v.$input.height())+_v.offsetTop+'px')}_v.isScroll=false}});_v.$timePickerDateList.on('click','.__time-picker-day',function(){if($(this).hasClass('__time-picker-prev-month')){_v.updateData({month:_v.s_month-1,day:$(this).text()})}else if($(this).hasClass('__time-picker-next-month')){_v.updateData({month:_v.s_month+1,day:$(this).text()})}else{_v.updateData({day:$(this).text()})}if(_v.closeTiming=='date'){_v.$input.val(_v.dataFormat(settings.format));_v.$timePickerWrapper.hide()}});$(window).on('scroll',function(){_v.isScroll=true;_v.input_window_top=parseInt(_v.$input.offset().top-parseInt($(window).scrollTop()))});_v.$valueSub.on('click',function(){var $thisVal=$(this).next();if($thisVal.hasClass('__time-picker-value-year')){_v.updateData({year:(_v.s_year-1)})}else if($thisVal.hasClass('__time-picker-value-month')){_v.updateData({month:(_v.s_month-1)})}else if($thisVal.hasClass('__time-picker-value-day')){_v.updateData({day:(_v.s_day-1)})}else if($thisVal.hasClass('__time-picker-value-hour')){_v.updateData({hour:(_v.s_hour-1)})}else if($thisVal.hasClass('__time-picker-value-minute')){_v.updateData({minute:(_v.s_minute-1)})}else if($thisVal.hasClass('__time-picker-value-second')){_v.updateData({second:(_v.s_second-1)})}});_v.$valueAdd.on('click',function(){var $thisVal=$(this).prev();if($thisVal.hasClass('__time-picker-value-year')){_v.updateData({year:(_v.s_year+1)})}else if($thisVal.hasClass('__time-picker-value-month')){_v.updateData({month:(_v.s_month+1)})}else if($thisVal.hasClass('__time-picker-value-day')){_v.updateData({day:(_v.s_day+1)})}else if($thisVal.hasClass('__time-picker-value-hour')){_v.updateData({hour:(_v.s_hour+1)})}else if($thisVal.hasClass('__time-picker-value-minute')){_v.updateData({minute:(_v.s_minute+1)})}else if($thisVal.hasClass('__time-picker-value-second')){_v.updateData({second:(_v.s_second+1)})}});_v.$downList.find('.__time-picker-down-list').on('click','.__time-picker-down-list-value',function(){var $this=$(this);if($this.hasClass('__time-picker-down-list-value-year')){_v.updateData({year:parseInt($this.text())})}else if($this.hasClass('__time-picker-down-list-value-month')){_v.updateData({month:parseInt($this.text())})}else if($this.hasClass('__time-picker-down-list-value-day')){_v.updateData({day:parseInt($this.text())})}else if($this.hasClass('__time-picker-down-list-value-hour')){_v.updateData({hour:parseInt($this.text())})}else if($this.hasClass('__time-picker-down-list-value-minute')){_v.updateData({minute:parseInt($this.text())})}else if($this.hasClass('__time-picker-down-list-value-second')){_v.updateData({second:parseInt($this.text())})}_v.$downList.hide()});_v.$downListYearPrev.on('click',function(){$('.__time-picker-down-list-value-year').each(function(){$(this).text(function(index,oldVal){return parseInt(oldVal)-15})})});_v.$downListYearNext.on('click',function(){$('.__time-picker-down-list-value-year').each(function(){$(this).text(function(index,oldVal){return parseInt(oldVal)+15})})});_v.$downListClose.click(function(){_v.$downList.hide()});_v.$value.on('click',function(){_v.$downListContent.empty();if(_v.$downList.css('display')=='none'){_v.$downList.show()}else{_v.$downList.hide()}var $thisVal=$(this);if($thisVal.hasClass('__time-picker-value-year')){_v.$downListYearPrev.show();_v.$downListYearNext.show()}else{_v.$downListYearPrev.hide();_v.$downListYearNext.hide()}var appendDom='<div class="__time-picker-flex">';if($thisVal.hasClass('__time-picker-value-year')){var len=15;for(var i=1;i<=len;i++){if(i==Math.ceil(len/2)){appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-year __time-picker-active">'+(_v.s_year+i-Math.ceil(len/2))+'</div>'}else{appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-year">'+(_v.s_year+i-Math.ceil(len/2))+'</div>'}if(i%3==0&&i<len){appendDom+='</div>';appendDom+='<div class="__time-picker-flex">'}else if(i==len){appendDom+='</div>'}}}else if($thisVal.hasClass('__time-picker-value-month')){var len=12;for(var i=1;i<=len;i++){if(i==_v.s_month){appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-month __time-picker-active">'+_v.addZero(i)+'</div>'}else{appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-month">'+_v.addZero(i)+'</div>'}if(i%4==0&&i<len){appendDom+='</div>';appendDom+='<div class="__time-picker-flex-left">'}else if(i==len){appendDom+='</div>'}}}else if($thisVal.hasClass('__time-picker-value-day')){var appendDom='<div class="__time-picker-flex-left">';var len=_v.getMonths(_v.s_year,_v.s_month);for(var i=1;i<=len;i++){if(i==_v.s_month){appendDom+='<div class="__time-picker-down-list-close"></div><div class="__time-picker-down-list-value __time-picker-active">'+_v.addZero(i)+'</div>'}else{appendDom+='<div class="__time-picker-down-list-value">'+_v.addZero(i)+'</div>'}if(i%4==0&&i<len){appendDom+='</div>';appendDom+='<div class="__time-picker-flex-left">'}else if(i==len){appendDom+='</div>'}}}else if($thisVal.hasClass('__time-picker-value-hour')){var len=24;for(var i=1;i<=len;i++){if((i-1)==_v.s_hour){appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-hour __time-picker-active">'+_v.addZero(i-1)+'</div>'}else{appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-hour">'+_v.addZero(i-1)+'</div>'}if(i%4==0&&i<len){appendDom+='</div>';appendDom+='<div class="__time-picker-flex-left">'}else if(i==len){appendDom+='</div>'}}}else if($thisVal.hasClass('__time-picker-value-minute')){var len=60;for(var i=1;i<=len;i++){if((i-1)==_v.s_minute){appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-minute __time-picker-active">'+_v.addZero(i-1)+'</div>'}else{appendDom+='<div class="__time-picker-down-list-value __time-picker-down-list-value-minute">'+_v.addZero(i-1)+'</div>'}if(i%6==0&&i<len){appendDom+='</div>';appendDom+='<div class="__time-picker-flex-left">'}else if(i==len){appendDom+='</div>'}}}else if($thisVal.hasClass('__time-picker-value-second')){var len=60;for(var i=1;i<=len;i++){if((i-1)==_v.s_second){appendDom+='<div class="__time-picker-down-list-value __time-picker-active">'+_v.addZero(i-1)+'</div>'}else{appendDom+='<div class="__time-picker-down-list-value">'+_v.addZero(i-1)+'</div>'}if(i%4==0&&i<len){appendDom+='</div>';appendDom+='<div class="__time-picker-flex-left">'}else if(i==len){appendDom+='</div>'}}}_v.$downListContent.append(appendDom)});_v.$timePickerMask.on('click',function(){_v.$timePickerWrapper.hide()});_v.$btn_confirm.on('click',function(){_v.$input.val(_v.dataFormat(settings.format));_v.$timePickerWrapper.hide()});_v.$btn_cancel.on('click',function(){_v.$timePickerWrapper.hide()});_v.$btn_today.on('click',function(){var date=new Date();var year=parseInt(date.getFullYear());var month=parseInt(date.getMonth())+1;var day=parseInt(date.getDate());var hour=parseInt(date.getHours());var minute=parseInt(date.getMinutes());var second=parseInt(date.getSeconds());_v.updateData({year:year,month:month,day:day,hour:hour,minute:minute,second:second})})})}});